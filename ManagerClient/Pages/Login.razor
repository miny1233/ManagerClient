@page "/login"
@layout EmptyLayout;

<PageTitle>登录页面</PageTitle>

<div class="loginBox">
        <h2>TOTP</h2>
        <div>
            <div class="item">
                <input type="text" @bind-value="firstOTP" required>
                <label for="">Code</label>
            </div>
            <button class="btn" @onclick="loginWithTOTP">LOGIN
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
</div>

@using AntDesign
@using ManagerClient.Data
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage

@inject LoginService loginService;
@inject NavigationManager navigation;
@inject ProtectedSessionStorage session;
@inject IMessageService _message

@code {
    
    public string firstOTP = "";

    protected override async void OnInitialized()
    {
        var state = await session.GetAsync<bool>("loginState");
        if (state.Value)
        {
             navigation.NavigateTo("/",replace: true);
        }
    }
    public async void loginWithTOTP()
    {
        bool state = loginService.CheckOTP(firstOTP);
        Console.WriteLine(state);

        await session.SetAsync("loginState",state);

        // var result = await session.GetAsync<bool>("loginState");

        if (state)
        {
            navigation.NavigateTo("/");
        }
    }
}
